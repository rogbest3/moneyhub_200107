<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
    
<mapper namespace="com.moneyhub.web.cus.mappers.AccountMapper">

	<!-- <insert id="createAcc" parameterType="Account">
	    INSERT INTO ACCOUNT (CEMAIL, BSDATE, ACCT_NO, BALANCE, DEPOSIT, WITHDRAWAL, 
	    					ACHCNTCD, CRTMEM, CRTDT, UPMEM, UPDT) 
	    VALUES (#{cemail}, now(), #{acctNo}, #{balance}, #{deposit}, #{withdrawal},
	    		#{achcntcd}, #{crtmem}, now(), #{upmem}, #{updt})
	</insert> -->
	
	<insert id="createAcc" parameterType="Account">
	    INSERT INTO ACCOUNT (CEMAIL, BSDATE, BALANCE, ACCT_NO, ACHCNTCD, CRTMEM, CRTDT) 
	    VALUES (#{cemail},now(),#{balance},#{acctNo},#{achcntcd}, #{crtmem}, now())
	</insert>
	
	<insert id="createAccHistory" parameterType="AccountHistory">
	    INSERT INTO ACCOUNT_HISTORY (CEMAIL, BSDATE, ACCT_NO, BALANCE, DEPOSIT, WITHDRAWAL,COMMENT, ASTATCD, CRTMEM, CRTDT) 
	    VALUES (#{cemail}, now(), #{acctNo}, #{balance}, #{deposit}, #{withdrawal}, #{comment},
	    		#{astatcd}, #{crtmem}, now())
	</insert>
	
	<select id="existAcc" resultType="integer"> <!--계좌 중복방지   -->
		SELECT COUNT(*) 
		FROM ACCOUNT
		WHERE ACCT_NO = #{acctNo}
	</select>
	
	 <select id="getAcc" resultType="Account"> <!--모든 고객 계좌 조회  -->
        SELECT CEMAIL cemail, ACCT_NO acctNo,  CRTDT crtdt
        FROM ACCOUNT
        WHERE CEMAIL = #{cemail}
   	 </select>
   	 
   	  <select id="getAccHis" resultType="AccountHistory"><!--고객 계좌내역  -->
        SELECT CEMAIL cemail, ACCT_NO acctNo, BALANCE balance,  CRTDT crtdt,DEPOSIT deposit,
        				WITHDRAWAL withdrawal,ATYPECD atypecd,ASTATCD astatcd, COMMENT comment
        FROM ACCOUNT_HISTORY
        WHERE CEMAIL = #{cemail}
   	 </select>
   	 
   	 <update id="balance" parameterType="Account"> <!--테스트 필요  -->
		UPDATE ACCOUNT
		SET BALANCE = #{balance},
		BSDATE = now()
		WHERE CEMAIL = #{cemail}
	</update>
	
	<insert id="withdrawal" parameterType="AccountHistory"> <!--테스트 필요  --> 
	    INSERT INTO ACCOUNT_HISTORY (CEMAIL, BSDATE, ACCT_NO, BALANCE, WITHDRAWAL,COMMENT, ASTATCD, CRTMEM, CRTDT) 
	    VALUES (#{cemail}, now(), #{acctNo}, #{balance}, #{withdrawal}, #{comment},#{astatcd}, #{crtmem}, now())
	</insert>
	
	<insert id="deposit" parameterType="AccountHistory"> <!--테스트 필요  -->
	    INSERT INTO ACCOUNT_HISTORY (CEMAIL, BSDATE, ACCT_NO, BALANCE, DEPOSIT,COMMENT, ASTATCD, CRTMEM, CRTDT) 
	    VALUES (#{cemail}, now(), #{acctNo}, #{balance}, #{deposit}, #{comment},#{astatcd}, #{crtmem}, now())
	</insert>
	
</mapper>